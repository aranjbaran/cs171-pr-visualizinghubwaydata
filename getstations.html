<!DOCTYPE html>
<script src="libs/d3/d3.min.js" charset="utf-8"></script>
<script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
<!-- <script src="http://d3js.org/d3.v2.min.js?2.10.0"></script> -->
<script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="js/countvis.js"></script>
<script src="js/pievis.js"></script>
<script src="js/mapvis.js"></script>
<script src="js/uservis.js"></script>


<!--Stylesheets-->
<link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">

<!-- Get some nice font-->
<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>


<!--------------------------------->
<!-- FROM HERE ON IT IS HW3 stuff-->
<!--------------------------------->

<!-- add own vis classes-->

<!-- add own stylesheet-->
<link rel="stylesheet" type="text/css" href="css/myStyle.css">


<html>


<script>
   


   var stations = ["3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98"]
        // intervals.keys
        // console.log(intervals_keys)

    var dataLoaded = function(error, _newAgg, _hubway, _capacity) {

        // var dataLoaded = function(error, _tripData, _newData) {
        if (!error) {


        
    
            // processData = _intervalData.records
            // console.log(processData)
            finalData = []
            var station;
            var name;
            var coordinates= []
            var intervals 
            var capacity;
            var timeintervals = {};
            
             for (i = 0; i < 1000; i++)
             {
                _capacity.forEach(function (k){
                    if (processData[i].station_id == k)
                    {

                        station = processData[i].station_id
                                 console.log(processData[i])
                                capacity = processData[i].latest_capacity
                    }

                    finalData.push(
                                    {"id": station,
                                    "name": name,
                                    "coordinates": [lat, longitude],

                                 
                                    "capacity": capacity,
                                    "intervals": {
                                        timeintervals
                                    }

                                })



                })


             }
         }
     }


                    // if (indexOf)   

                    //             station = processData[i].station_id
                    //              console.log(processData[i])
                    //             capacity = processData[i].latest_capacity
                    //              capacityData.push(
                    //                 {"stationid": station,
                                 
                    //                 "capacity": capacity

                    //             })

                    //         }

                            // console.log(_intervalData)
                            // console.log(d)
                                // if(intervals[d].totaltrips[0])
                               

                                    
                                // else return;

                        // })
            // console.log(_intervalData)
              // console.log(station_input("08", "5"))

            // var trips = sum_trips(intervals)
            // console.log(trips)
            // var number = current_number(intervals, 11)
            // console.log(number)
            // initVis();
        // } // Error end
        // else (console.log(error))

        // Function end
    



    var startHere = function() {


        queue()


        // .defer(d3.json, 'data/trips_aug12.json')
        // .defer(d3.json, 'data/triptest.json')
        .defer(d3.json, 'data/new_aggformatted.json')
            .defer(d3.json, 'hubwaydatachallenge.json')
            .defer(d3.json, 'data/stationcapacity.json')


        .await(dataLoaded);

        setTimeout(function() {
            var stringintervals = JSON.stringify(finalData)

            var url = 'data:text/json;charset=utf8,' + encodeURIComponent(stringintervals);
            window.open(url, '_blank');
            window.focus();
        }, 8000)



    }
    startHere();






            //         )
            //     for (j = 0; j < intervals_keys.length; j++) {
            //         var arrivals = 0
            //         var departures = 0
            //         for (i = 0; i < stations.length; i++) {

            //             var station_info = d[intervals_keys[j]][stations[i]]
            //             station_info.forEach(function(k) {
            //                 // if ()
            //                 arrivals += k["bike_arrivals"]

            //             })



            //         }




            //         return {"id": ,
            //                 "weekday":
            //                     {
            //                         "arrivals":
            //                         "departures":
            //                     },
            //                 "weekend":
            //                      {
            //                         "arrivals":
            //                         "departures":
            //                     }  
            //                 }
            //         arrivals, "departures": departures}

            //     }

            // }
</script>
</body>

</html>